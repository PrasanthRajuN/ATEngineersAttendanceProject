@model ATEngineersAttendanceProject.Models.Admin.CombinedViewModel
@{
    Layout = null;
}
                                                                          
<!DOCTYPE html>
<html lang="en">                                                            
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AT Engineers Attendance</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <style>
        body { background-color: #e5d0ff; }
        .attendance-table { display: flex; flex-direction: column; justify-content: center; align-items: center; border-radius: 8px; padding: 20px; background-color: #d5b3ff; }
        th, td { text-align: center; vertical-align: middle; }
        .table-body { background-color: white; }
        .form-select, .input-field { width: 80%; display: inline-block; }
        .select-container { text-align: end; vertical-align: middle; }
        .table-responsive { width: 100%; border-radius: 10px; }
        .allot-btn { background-color: #4CAF50; color: white; padding: 10px 20px; border: none; border-radius: 5px; }
        .allot-btn:hover { background-color: #45a049; }
    </style>
</head>
<body>
    <div class="toast-container position-fixed top-0 end-0 p-3" style="z-index: 1055;">
        <div id="successToast" class="toast align-items-center text-bg-success border-0" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="d-flex">
                <div class="toast-body">
                    @ViewBag.SuccessMessage
                </div>
                <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
        </div>
    </div>
    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-md-10 col-lg-8">
                <a href="@Url.Action("AdminPage","Admin")" class="btn btn-primary mb-2 mr-2">Back</a>
                <form method="post" action="@Url.Action("AllotWork", "Allotwork")" enctype="multipart/form-data">
                    <div class="attendance-table p-4 shadow">
                        <h3 class="text-center text-uppercase mb-4">AllotWork Page</h3>
                        <div class="table-responsive">
                            <table style="margin:0px;" class="table  table-hover">
                                <tbody class="table-body">
                                <tr>
                                    <td style="width:10px; text-align:start; padding-left:30px;"><label for="section" class="col-sm-4 col-form-label">Section</label></td>
                                    <td style="width:150px;" class="select-container">
                                        <select name="section" class="form-select" id="section" required>
                                            <option value="">Select</option>
                                            @if (Model.Sections != null && Model.Sections.Any())
                                            {
                                                foreach (var sec in Model.Sections)
                                                {
                                                    <option>@sec.Name</option>
                                                }
                                            }
                                        </select>
                                    </td>
                                </tr>
                                <tr>
                                    <td style="width:10px; text-align:start; padding-left:30px;"><label for="department" class="col-sm-4 col-form-label">Department</label></td>
                                    <td style="width:10px;" class="select-container">
                                        <select name="department" class="form-select" id="department" required>
                                            <option value="">Select</option>
                                            @if (Model.Departments != null && Model.Departments.Any())
                                            {
                                                foreach (var sec in Model.Departments)
                                                {
                                                    <option>@sec.Name</option>
                                                }
                                            }
                                        </select>
                                    </td>
                                </tr>
                                <tr>
                                    <td style="width:10px; text-align:start; padding-left:30px;"><label for="district" class="col-sm-4 col-form-label">District</label></td>
                                    <td style="width:10px;" class="select-container">
                                            <select name="district" class="form-select" id="districtDropdown" onchange="loadMandals()" required>
                                            <option value="">-- Select a District --</option>
                                            @if (Model.Locations != null && Model.Locations.Any())
                                            {
                                                foreach (var sec in Model.Locations)
                                                {
                                                    <option>@sec.District</option>
                                                }
                                            }
                                        </select>
                                    </td>
                                </tr>
                                <tr>
                                    <td style="width:10px; text-align:start; padding-left:30px;"><label for="mandal" class="col-sm-4 col-form-label">Mandal</label></td>
                                    <td style="width:10px;" class="select-container">
                                            <select name="mandal" class="form-select" id="mandalDropdown" onchange="loadVillages()" required>
                                                <option value="">-- Select a Mandal --</option>
                                            </select>
                                    </td>
                                </tr>
                                <tr>
                                    <td style="width:10px; text-align:start; padding-left:30px;"><label for="village" class="col-sm-4 col-form-label">Village</label></td>
                                    <td style="width:10px;" class="select-container">
                                            <select name="village" class="form-select" id="villageDropdown" onchange="loadLocations()" required>
                                                <option value="">-- Select a Village --</option>
                                            </select>

                                    </td>
                                </tr>
                               
                                <tr>
                                    <td style="width:10px; text-align:start; padding-left:30px;"><label for="location" class="col-sm-4 col-form-label">Locations</label></td>
                                    <td style="width:10px;" class="select-container">
                                        <select name="location" class="form-select" id="locationDropdown" required>
                                            <option value="">-- Select a Location --</option>
                                        </select>
                                    </td>
                                </tr>
                                    <tr>
                                        <td style="width:10px; text-align:start; padding-left:30px;"><label for="atEngineerId" class="col-sm-4 col-form-label">ATEngineers</label></td>
                                        <td style="width:10px;" class="select-container">
                                            <select name="atEngineerId" class="form-select" id="atEngineerId" required>
                                                <option value="">Select</option>
                                                @if (Model.ATEngineer != null && Model.ATEngineer.Any())
                                                {
                                                    foreach (var sec in Model.ATEngineer)
                                                    {
                                                        <option value="@sec.Id">@sec.Id - @sec.Name</option>
                                                    }
                                                }
                                            </select>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td><label for="FinYear" class="col-form-label">Financial Year</label></td>
                                        <td class="select-container">
                                            <input type="text" id="FinYear" class="form-select bg-light-blue input-field" style="border-width:0px;" readonly required/>
                                        </td>
                                    </tr>

                                    <tr>
                                        <td><label for="pono" class="col-form-label">PO No</label></td>
                                        <td class="select-container">
                                            <input type="text" name="pono" class="form-select bg-light-blue input-field" required/>
                                        </td>
                                    </tr>
                                     <tr>
                                         <td><label for="pocode" class="col-form-label">PO Code</label></td>
                                        <td class="select-container">
                                            <input type="input" name="pocode" class="form-select bg-light-blue input-field" required/>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td><label for="podate" class="col-form-label">PO Date</label></td>
                                        <td class="select-container">
                                            <input type="date" name="podate" class="form-select bg-light-blue input-field" required/>
                                        </td>
                                    </tr>
                                   
                                    <tr>
                                        <td><label for="pocopy" class="col-form-label">PO Copy</label></td>
                                        <td class="select-container">
                                            <input type="file" name="pocopy" id="postalCopy" class="form-select bg-light-blue input-field" required/>
                                        </td>
                                    </tr>

                                    <tr>
                                        <td><label for="alloted_date" class="col-form-label">Alloted Date</label></td>
                                        <td class="select-container">
                                            <input type="date" id="AllotedDate" name="alloted_date" class="form-select bg-light-blue input-field" required/>
                                        </td>
                                    </tr>
                                   
                                </tbody>
                            </table>
                        </div>
                        <div class="text-center">
                            <button type="submit" class="allot-btn">Allot</button>
                        </div>
                    </div>
                </form>
                @if (ViewBag.AlertMessage != null)
                {
                    <div>@ViewBag.AlertMessage</div>
                }
            </div>
        </div>
    </div>
     <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function loadMandals() {
            const district = document.getElementById("districtDropdown").value;

            if (district) {
                fetch(`/AllotWork/GetMandals?district=${encodeURIComponent(district)}`)
                    .then(response => response.json())
                    .then(data => {
                        const mandalDropdown = document.getElementById("mandalDropdown");
                        mandalDropdown.innerHTML = '<option value="">-- Select a Mandal --</option>';

                        data.forEach(mandal => {
                            const option = document.createElement("option");
                            option.value = mandal;
                            option.text = mandal;
                            mandalDropdown.add(option);
                        });
                    })
                    .catch(error => console.error("Error:", error));
            }
        }
        function loadVillages() {
            const mandal = document.getElementById("mandalDropdown").value;

            if (mandal) {
                fetch(`/AllotWork/GetVillages?mandal=${encodeURIComponent(mandal)}`)
                    .then(response => response.json())
                    .then(data => {
                        const villageDropdown = document.getElementById("villageDropdown");
                        villageDropdown.innerHTML = '<option value="">-- Select a Village --</option>';

                        data.forEach(village => {
                            const option = document.createElement("option");
                            option.value = village;
                            option.text = village;
                            villageDropdown.add(option);
                        });
                    })
                    .catch(error => console.error("Error:", error));
            }
        }
        function loadLocations() {
            const village = document.getElementById("villageDropdown").value;

            if (village) {
                fetch(`/AllotWork/GetLocations?village=${encodeURIComponent(village)}`)
                    .then(response => response.json())
                    .then(data => {
                        const locationDropdown = document.getElementById("locationDropdown");
                        locationDropdown.innerHTML = '<option value="">-- Select a Location --</option>';

                        data.forEach(location => {
                            const option = document.createElement("option");
                            option.value = location;
                            option.text = location;
                            locationDropdown.add(option);
                        });
                    })
                    .catch(error => console.error("Error:", error));
            }
        }
        let date = new Date();
        let year = date.getFullYear();
        document.getElementById("FinYear").value = year + " - " + (year + 1);

        let mm = String(date.getMonth() + 1).padStart(2, '0');
        let dd = String(date.getDate()).padStart(2, '0');
        let formattedDate = year + '-' + mm + '-' + dd;
        document.getElementById('AllotedDate').value = formattedDate;
        window.onload = function () {
            var successMessage = '@ViewBag.SuccessMessage';
            if (successMessage) {
                var toastElement = document.getElementById('successToast');
                var toast = new bootstrap.Toast(toastElement);
                toast.show();
            }
        };
    </script>
</body>
</html>